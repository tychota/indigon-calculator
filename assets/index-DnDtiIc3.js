import{j as e,a6 as C,a7 as S,a8 as v,a9 as k,aa as M,ab as R,ac as j,ad as D,ae as I,r as d,af as T}from"./react-vendor-AwMjfY1Y.js";import{S as P,P as h,T as f,a as c,b as A,c as u,N as L,u as z,B as x,d as E,M as F,A as B,D as y,F as p,e as G,f as N,C as O,G as g,g as V,h as K,i as W}from"./mantine-vendor-CJqgBwDC.js";import"./vendor-DpvEjjzn.js";import"./recharts-vendor-Cl8k0wLg.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const H={fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"0.75rem"}},w=[{title:"Server Settings",fields:[{key:"server.tickInterval",label:"Tick Interval",min:.001,max:1,step:.001,precision:3,tooltip:"Server tick rate (seconds)"},{key:"server.duration",label:"Duration",min:1,max:300,step:1,precision:0,tooltip:"Simulation duration (seconds)"}]},{title:"Player Settings",fields:[{key:"player.manaMax",label:"Max Mana",min:100,max:3e4,step:1,precision:0,tooltip:"Player maximum mana"},{key:"player.manaRegen",label:"Mana Regen",min:0,max:2e4,step:1,precision:0,tooltip:"Mana regenerated per second"}]},{title:"Skill Settings",fields:[{key:"skill.baseCost",label:"Gem Base Cost",min:0,max:1e3,step:1,precision:0,tooltip:"Base mana cost of the skill gem"},{key:"skill.costMultiplier",label:"Cost Multiplier",min:.1,max:5,step:1e-4,precision:4,tooltip:"Cost multiplier from support gem"},{key:"skill.extraCostPercent",label:"Extra Cost %",min:0,max:1,step:.01,precision:3,tooltip:"Extra cost (% max mana), e.g. Archmage support"},{key:"skill.incCostPercent",label:"Increased Cost %",min:0,max:500,step:1,precision:0,tooltip:"Increased cost (%), e.g. Tree, gear, Indigon effects"},{key:"skill.moreLessCost",label:"More/Less Cost Multiplier",min:0,max:2,step:.01,precision:2,tooltip:"More/Less cost multiplier, e.g. Tree, Gear, gem supports"},{key:"skill.castPerSecond",label:"Casts per Second",min:.1,max:20,step:.1,precision:1,tooltip:"Casts per second"}]},{title:"Indigon Settings",fields:[{key:"indigon.dmgPer200",label:"Damage % per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Damage increase per 200 mana spent (35-50%)"},{key:"indigon.costIncPer200",label:"Cost % Increase per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Cost increase per 200 mana spent (35-50%)"}]}];function $({form:s}){return e.jsx(P,{children:w.map(a=>{const r=a.title==="Indigon Settings",o=r?s.values.indigon.dmgPer200:void 0,t=r?s.values.indigon.costIncPer200:void 0,i=r&&(o!==void 0&&(o<35||o>50)||t!==void 0&&(t<35||t>50));return e.jsxs(h,{shadow:"xs",radius:"md",p:"md",style:{backgroundColor:i?"#fff3e0":void 0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:30,marginBottom:"0"},children:[e.jsx(f,{order:4,mb:"lg",children:a.title}),i&&e.jsx(c,{c:"orange",size:"xs",mb:"lg",children:"Such values require corrupted indigon."})]}),e.jsx(A,{cols:2,spacing:"md",children:a.fields.map(n=>e.jsx(u,{label:n.tooltip||"",disabled:!n.tooltip,children:e.jsx(L,{size:"sm",label:n.label,...s.getInputProps(n.key),min:n.min,max:n.max,step:n.step,decimalScale:n.precision,error:s.errors[n.key]})},n.key))})]},a.title)})})}const q=(s,a)=>a.some(r=>s>=r.x1&&s<=r.x2),J=s=>s.filter(a=>a.actual>a.ideal).map(a=>({x1:a.ideal,x2:a.actual}));function _({results:s}){const{ref:a,height:r}=z(),o=s.time.map((l,m)=>({time:l,mana:s.manaLeft[m],damage:s.spellDmg[m],missed:s.missedCast[m]})),t=J(s.castDelays),i=o.map(l=>({...l,delayArea:q(l.time,t)?l.damage:null})),n=s.castEvents.map(l=>l.actual);return e.jsxs(h,{shadow:"sm",radius:"md",p:"lg",style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(x,{ref:a,style:{flexGrow:1},children:r>0&&e.jsx(C,{width:"100%",height:r,children:e.jsxs(S,{data:i,children:[e.jsx(v,{dataKey:"time",type:"number",tick:{fontSize:12}}),e.jsx(k,{tick:{fontSize:12}}),e.jsx(M,{}),e.jsx(R,{}),e.jsx(j,{type:"monotone",dataKey:"mana",stroke:"#1E71A7",dot:!1,name:"Mana"}),e.jsx(j,{type:"monotone",dataKey:"damage",stroke:"#337128",dot:!1,name:"Damage"}),e.jsx(D,{type:"monotone",dataKey:"delayArea",name:"Delayed Cast",stroke:"red",fill:"red",fillOpacity:.1,dot:!1,activeDot:!1}),n.map((l,m)=>e.jsx(I,{x:l,stroke:"#000",strokeOpacity:.1,strokeDasharray:"3 3"},m))]})})})]})}function U({results:s}){const a=d.useMemo(()=>s.time.map((t,i)=>({time:t,spellDmg:s.spellDmg[i],manaLeft:s.manaLeft[i],manaCost:s.manaCost[i]})),[s]),r=d.useMemo(()=>[{accessorKey:"time",header:"Time (s)",Cell:({cell:t})=>t.getValue().toFixed(3)},{accessorKey:"spellDmg",header:"Spell Dmg %"},{accessorKey:"manaLeft",header:"Mana Left"},{accessorKey:"manaCost",header:"Mana Cost"}],[]),o=E({columns:r,data:a,enableColumnActions:!1,enableColumnFilters:!1,enableSorting:!1,enablePagination:!1,enableTopToolbar:!1,enableBottomToolbar:!1,enableFullScreenToggle:!1,enableHiding:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,layoutMode:"grid",mantineTableContainerProps:{style:{maxHeight:410}},mantineTableProps:{striped:"odd",withRowBorders:!0,withColumnBorders:!0,withTableBorder:!1}});return e.jsxs(h,{shadow:"sm",radius:"md",p:"lg",h:"100%",style:{display:"flex",flexDirection:"column"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(x,{style:{flexGrow:1},children:e.jsx(F,{table:o})})]})}function X(s){return new Worker("/indigon-poe2-calculator/assets/simulationWorker-DWBk_rnO.js",{name:s==null?void 0:s.name})}function Y(s){const a=s.timeToMaxDmg,r=s.maxSpellDmg,o=parseFloat(s.missRateAfterFirstMiss.toFixed(2)),t=parseFloat((100-o).toFixed(2)),i=Math.round(r*(t/100));let n="other",l="Check your stats.";return o<40?(n="perfect",l="Excellent - minimal misses."):o>=70?(n="red",l="Unstable - high miss rate."):(n="warning",l="Moderate miss rate."),{status:n,message:l,details:{rampTime:a,maxSpellDmg:r,missRate:o,adjustedCastRate:t,estimatedSustainedDmg:i,additionalNote:"Sustaining Indigon without excessive misses is easier at slower cast speeds (which may lengthen ramp time)."}}}function Q({analysis:s}){const a={red:"red",warning:"yellow",perfect:"green",other:"blue"},{rampTime:r,maxSpellDmg:o,missRate:t,adjustedCastRate:i,estimatedSustainedDmg:n,additionalNote:l}=s.details;return e.jsxs(B,{color:a[s.status]||"blue",title:"Advices",children:[e.jsx(c,{size:"sm",children:s.message}),e.jsx(c,{size:"xs",mt:"xs",color:"dimmed",children:l}),e.jsx(y,{my:"sm"}),e.jsxs(p,{gap:"md",direction:"column",children:[e.jsxs(p,{justify:"space-between",wrap:"wrap",children:[e.jsx(u,{label:"Time needed to reach the maximum Indigon bonus",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Ramp Time:"})," ",r.toFixed(2),"s"]})}),e.jsx(u,{label:"The percentage of expected casts missed after reaching maximum ramp (lower is better)",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Miss Rate:"})," ",t.toFixed(2),"%"]})})]}),e.jsxs(p,{justify:"space-between",wrap:"wrap",mt:"xs",children:[e.jsx(u,{label:"Highest bonus achieved during the simulation",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Max Indigon Bonus:"})," ",o,"%"]})}),e.jsx(u,{label:"Effective cast rate, calculated as 100 - Miss Rate",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Effective Cast Rate:"})," ",i.toFixed(2),"%"]})})]}),e.jsxs(p,{justify:"space-between",wrap:"wrap",mt:"xs",children:[e.jsx(c,{size:"sm",mt:"xs"}),e.jsx(u,{label:"Estimated sustained bonus computed as Max Bonus multiplied by Effective Cast Rate divided by 100",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Estimated Sustained Bonus:"})," ",n,"%"]})})]}),e.jsx(y,{my:"sm"})]})]})}function Z({config:s}){const[a,r]=d.useState("chart"),[o,t]=d.useState(null),[i,n]=d.useState(null);return d.useEffect(()=>{const l=new X;return l.postMessage(s),l.onmessage=m=>{const b=m.data;t(b),n(Y(b))},()=>l.terminate()},[s]),!o||!i?e.jsx(x,{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx("div",{children:"Waiting for data..."})}):e.jsxs(x,{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(G,{value:a,onChange:r,data:[{label:"Chart",value:"chart"},{label:"Table",value:"table"}],mb:"sm"}),e.jsx(x,{style:{flexGrow:1,overflow:"hidden"},children:a==="chart"?e.jsx(_,{results:o}):e.jsx(U,{results:o})}),e.jsx(Q,{analysis:i})]})}const ee=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"icon icon-tabler icons-tabler-outline icon-tabler-brand-github",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z"}),e.jsx("path",{d:"M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"})]});function se(){return e.jsx(V,{gap:"xs",style:{position:"absolute",top:10,right:10},children:e.jsx(K,{href:"https://github.com/tychota/indigon-calculator",target:"_blank",rel:"noopener noreferrer",children:e.jsx(ee,{})})})}function te(){const a=N({initialValues:{server:{tickInterval:.033,duration:40},player:{manaMax:6e3,manaRegen:3400},skill:{baseCost:72,costMultiplier:1.3799,extraCostPercent:0,incCostPercent:10,moreLessCost:.7,castPerSecond:5},indigon:{dmgPer200:33,costIncPer200:42}},validate:Object.fromEntries(w.flatMap(r=>r.fields.map(o=>[o.key,t=>{const{min:i,max:n,label:l}=o;return i!==void 0&&t<i?`${l} must be ≥ ${i}`:n!==void 0&&t>n?`${l} must be ≤ ${n}`:null}]))),onValuesChange:r=>{window.localStorage.setItem("form",JSON.stringify(r))}});return d.useEffect(()=>{if(window.localStorage.getItem("form"))try{a.setValues(JSON.parse(window.localStorage.getItem("form")))}catch{console.log("Failed to parse stored value")}},[]),e.jsxs(O,{fluid:!0,py:"md",children:[e.jsx(se,{}),e.jsx(f,{ta:"center",mb:"lg",children:"Indigon Spell Simulator"}),e.jsx(f,{order:3,ta:"center",mb:"xl",children:"Simulate your Indigon ramping in Poe2."}),e.jsxs(g,{gutter:"lg",align:"stretch",children:[e.jsx(g.Col,{span:{base:12,md:5},children:e.jsx(h,{shadow:"xs",radius:"md",p:"md",h:"100%",children:e.jsx($,{form:a})})}),e.jsx(g.Col,{span:{base:12,md:7},children:e.jsx(p,{direction:"column",gap:"md",h:"100%",children:e.jsx(h,{shadow:"xs",radius:"md",p:"md",style:{flexGrow:1,overflow:"hidden"},children:e.jsx(Z,{config:a.values})})})})]})]})}T.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(W,{theme:{...H},defaultColorScheme:"auto",children:e.jsx(te,{})})}));
