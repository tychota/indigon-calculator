import{j as e,a6 as j,a7 as C,a8 as w,a9 as k,aa as S,ab as v,ac as b,ad as M,ae as R,r as d,af as D}from"./react-vendor-AwMjfY1Y.js";import{S as I,P as u,T as g,a as c,b as P,c as T,N as L,u as z,B as p,d as A,M as F,A as E,D as G,F as x,e as B,f as N,C as K,G as h,g as O,h as V,i as W}from"./mantine-vendor-CJqgBwDC.js";import"./vendor-DpvEjjzn.js";import"./recharts-vendor-Cl8k0wLg.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function l(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(t){if(t.ep)return;t.ep=!0;const a=l(t);fetch(t.href,a)}})();const $={fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"0.75rem"}},y=[{title:"Server Settings",fields:[{key:"server.tickInterval",label:"Tick Interval",min:.001,max:1,step:.001,precision:3,tooltip:"Server tick rate (seconds)"},{key:"server.duration",label:"Duration",min:1,max:300,step:1,precision:0,tooltip:"Simulation duration (seconds)"}]},{title:"Player Settings",fields:[{key:"player.manaMax",label:"Max Mana",min:100,max:3e4,step:1,precision:0,tooltip:"Player maximum mana"},{key:"player.manaRegen",label:"Mana Regen",min:0,max:2e4,step:1,precision:0,tooltip:"Mana regenerated per second"}]},{title:"Skill Settings",fields:[{key:"skill.baseCost",label:"Gem Base Cost",min:0,max:1e3,step:1,precision:0,tooltip:"Base mana cost of the skill gem"},{key:"skill.costMultiplier",label:"Cost Multiplier",min:.1,max:5,step:1e-4,precision:4,tooltip:"Cost multiplier from support gem"},{key:"skill.extraCostPercent",label:"Extra Cost %",min:0,max:1,step:.01,precision:3,tooltip:"Extra cost (% max mana), e.g. Archmage support"},{key:"skill.incCostPercent",label:"Increased Cost %",min:0,max:500,step:1,precision:0,tooltip:"Increased cost (%), e.g. Tree, gear, Indigon effects"},{key:"skill.moreLessCost",label:"More/Less Cost Multiplier",min:0,max:2,step:.01,precision:2,tooltip:"More/Less cost multiplier, e.g. Tree, Gear, gem supports"},{key:"skill.castPerSecond",label:"Casts per Second",min:.1,max:20,step:.1,precision:1,tooltip:"Casts per second"}]},{title:"Indigon Settings",fields:[{key:"indigon.dmgPer200",label:"Damage % per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Damage increase per 200 mana spent"},{key:"indigon.costIncPer200",label:"Cost % Increase per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Cost increase per 200 mana spent"}]}];function H({form:s}){return e.jsx(I,{children:y.map(i=>{const l=i.title==="Indigon Settings",r=l?s.values.indigon.dmgPer200:void 0,t=l?s.values.indigon.costIncPer200:void 0,a=l&&(r!==void 0&&(r<35||r>50)||t!==void 0&&(t<35||t>50));return e.jsxs(u,{shadow:"xs",radius:"md",p:"md",style:{backgroundColor:a?"#fff3e0":void 0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:30,marginBottom:"0"},children:[e.jsx(g,{order:4,mb:"lg",children:i.title}),a&&e.jsx(c,{c:"orange",size:"xs",mb:"lg",children:"Such values require corrupted indigon."})]}),e.jsx(P,{cols:2,spacing:"md",children:i.fields.map(n=>e.jsx(T,{label:n.tooltip||"",disabled:!n.tooltip,children:e.jsx(L,{size:"sm",label:n.label,...s.getInputProps(n.key),min:n.min,max:n.max,step:n.step,decimalScale:n.precision,error:s.errors[n.key]})},n.key))})]},i.title)})})}const q=(s,i)=>i.some(l=>s>=l.x1&&s<=l.x2),U=s=>s.filter(i=>i.actual>i.ideal).map(i=>({x1:i.ideal,x2:i.actual}));function X({results:s}){const{ref:i,height:l}=z(),r=s.time.map((o,m)=>({time:o,mana:s.manaLeft[m],damage:s.spellDmg[m],missed:s.missedCast[m]})),t=U(s.castDelays),a=r.map(o=>({...o,delayArea:q(o.time,t)?o.damage:null})),n=s.castEvents.map(o=>o.actual);return e.jsxs(u,{shadow:"sm",radius:"md",p:"lg",style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(p,{ref:i,style:{flexGrow:1},children:l>0&&e.jsx(j,{width:"100%",height:l,children:e.jsxs(C,{data:a,children:[e.jsx(w,{dataKey:"time",type:"number",tick:{fontSize:12}}),e.jsx(k,{tick:{fontSize:12}}),e.jsx(S,{}),e.jsx(v,{}),e.jsx(b,{type:"monotone",dataKey:"mana",stroke:"#1E71A7",dot:!1,name:"Mana"}),e.jsx(b,{type:"monotone",dataKey:"damage",stroke:"#337128",dot:!1,name:"Damage"}),e.jsx(M,{type:"monotone",dataKey:"delayArea",name:"Delayed Cast",stroke:"red",fill:"red",fillOpacity:.1,dot:!1,activeDot:!1}),n.map((o,m)=>e.jsx(R,{x:o,stroke:"#000",strokeOpacity:.1,strokeDasharray:"3 3"},m))]})})})]})}function Y({results:s}){const i=d.useMemo(()=>s.time.map((t,a)=>({time:t,spellDmg:s.spellDmg[a],manaLeft:s.manaLeft[a],manaCost:s.manaCost[a]})),[s]),l=d.useMemo(()=>[{accessorKey:"time",header:"Time (s)",Cell:({cell:t})=>t.getValue().toFixed(3)},{accessorKey:"spellDmg",header:"Spell Dmg %"},{accessorKey:"manaLeft",header:"Mana Left"},{accessorKey:"manaCost",header:"Mana Cost"}],[]),r=A({columns:l,data:i,enableColumnActions:!1,enableColumnFilters:!1,enableSorting:!1,enablePagination:!1,enableTopToolbar:!1,enableBottomToolbar:!1,enableFullScreenToggle:!1,enableHiding:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,layoutMode:"grid",mantineTableContainerProps:{style:{maxHeight:410}},mantineTableProps:{striped:"odd",withRowBorders:!0,withColumnBorders:!0,withTableBorder:!1}});return e.jsxs(u,{shadow:"sm",radius:"md",p:"lg",h:"100%",style:{display:"flex",flexDirection:"column"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(p,{style:{flexGrow:1},children:e.jsx(F,{table:r})})]})}function _(s){return new Worker("/indigon-poe2-calculator/assets/simulationWorker-C72j8-xt.js",{name:s==null?void 0:s.name})}function J(s){const i=s.timeToMaxDmg,l=s.maxSpellDmg,r=parseFloat(s.missRateAfterFirstMiss.toFixed(2)),t=parseFloat((100-r).toFixed(2)),a=Math.round(l*(t/100));let n="other",o="Check your stats.";return r<20?(n="perfect",o="Excellent - minimal misses."):r>=50?(n="red",o="Unstable - high miss rate."):(n="warning",o="Moderate miss rate."),{status:n,message:o,details:{rampTime:i,maxSpellDmg:l,missRate:r,adjustedCastRate:t,estimatedSustainedDmg:a,additionalNote:"Sustaining Indigon without excessive misses is easier at slower cast speeds (which may lengthen ramp time)."}}}function Q({analysis:s}){const i={red:"red",warning:"yellow",perfect:"green",other:"blue"},{rampTime:l,maxSpellDmg:r,missRate:t,adjustedCastRate:a,estimatedSustainedDmg:n,additionalNote:o}=s.details;return e.jsxs(E,{color:i[s.status]||"blue",title:"Advices",children:[e.jsx(c,{size:"sm",children:s.message}),e.jsx(c,{size:"xs",mt:"xs",color:"dimmed",children:o}),e.jsx(G,{my:"sm"}),e.jsxs(x,{gap:"md",justify:"space-between",wrap:"wrap",children:[e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Ramp Time:"})," ",l.toFixed(2),"s"]}),e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Miss Rate:"})," ",t.toFixed(2),"%"]})]}),e.jsxs(x,{gap:"md",justify:"space-between",wrap:"wrap",mt:"xs",children:[e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Max Indigon Bonus:"})," ",r,"%"]}),e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Effective Cast Rate:"})," ",a.toFixed(2),"%"]})]}),e.jsxs(x,{gap:"md",justify:"space-between",wrap:"wrap",mt:"xs",children:[e.jsx(c,{size:"sm",children:" "}),e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Estimated Sustained Bonus:"})," ",n,"%"]})]})]})}function Z({config:s}){const[i,l]=d.useState("chart"),[r,t]=d.useState(null),[a,n]=d.useState(null);return d.useEffect(()=>{const o=new _;return o.postMessage(s),o.onmessage=m=>{const f=m.data;t(f),n(J(f))},()=>o.terminate()},[s]),!r||!a?e.jsx(p,{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx("div",{children:"Waiting for data..."})}):e.jsxs(p,{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(B,{value:i,onChange:l,data:[{label:"Chart",value:"chart"},{label:"Table",value:"table"}],mb:"sm"}),e.jsx(p,{style:{flexGrow:1,overflow:"hidden"},children:i==="chart"?e.jsx(X,{results:r}):e.jsx(Y,{results:r})}),e.jsx(Q,{analysis:a})]})}const ee=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"icon icon-tabler icons-tabler-outline icon-tabler-brand-github",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z"}),e.jsx("path",{d:"M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"})]});function se(){return e.jsx(O,{gap:"xs",style:{position:"absolute",top:10,right:10},children:e.jsx(V,{href:"https://github.com/tychota/indigon-calculator",target:"_blank",rel:"noopener noreferrer",children:e.jsx(ee,{})})})}function te(){const i=N({initialValues:{server:{tickInterval:.033,duration:20},player:{manaMax:6e3,manaRegen:3400},skill:{baseCost:72,costMultiplier:1.3799,extraCostPercent:0,incCostPercent:10,moreLessCost:.7,castPerSecond:5},indigon:{dmgPer200:35,costIncPer200:35}},validate:Object.fromEntries(y.flatMap(l=>l.fields.map(r=>[r.key,t=>{const{min:a,max:n,label:o}=r;return a!==void 0&&t<a?`${o} must be ≥ ${a}`:n!==void 0&&t>n?`${o} must be ≤ ${n}`:null}])))});return e.jsxs(K,{fluid:!0,py:"md",children:[e.jsx(se,{}),e.jsx(g,{ta:"center",mb:"lg",children:"Indigon Spell Simulator"}),e.jsx(g,{order:3,ta:"center",mb:"xl",children:"Simulate your Indigon ramping in Poe2."}),e.jsxs(h,{gutter:"lg",align:"stretch",children:[e.jsx(h.Col,{span:{base:12,md:5},children:e.jsx(u,{shadow:"xs",radius:"md",p:"md",h:"100%",children:e.jsx(H,{form:i})})}),e.jsx(h.Col,{span:{base:12,md:7},children:e.jsx(x,{direction:"column",gap:"md",h:"100%",children:e.jsx(u,{shadow:"xs",radius:"md",p:"md",style:{flexGrow:1,overflow:"hidden"},children:e.jsx(Z,{config:i.values})})})})]})]})}D.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(W,{theme:{...$},defaultColorScheme:"auto",children:e.jsx(te,{})})}));
