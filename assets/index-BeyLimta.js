import{j as e,a6 as w,a7 as C,a8 as S,a9 as k,aa as v,ab as M,ac as y,ad as R,ae as D,r as m,af as I}from"./react-vendor-AwMjfY1Y.js";import{S as T,P as h,T as f,a as c,b as P,c as u,N as A,u as z,B as x,d as L,M as E,A as F,D as B,F as p,e as G,f as N,C as O,G as g,g as V,h as K,i as W}from"./mantine-vendor-CJqgBwDC.js";import"./vendor-DpvEjjzn.js";import"./recharts-vendor-Cl8k0wLg.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();const H={fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"0.75rem"}},j=[{title:"Server Settings",fields:[{key:"server.tickInterval",label:"Tick Interval",min:.001,max:1,step:.001,precision:3,tooltip:"Server tick rate (seconds)"},{key:"server.duration",label:"Duration",min:1,max:300,step:1,precision:0,tooltip:"Simulation duration (seconds)"}]},{title:"Player Settings",fields:[{key:"player.manaMax",label:"Max Mana",min:100,max:3e4,step:1,precision:0,tooltip:"Player maximum mana"},{key:"player.manaRegen",label:"Mana Regen",min:0,max:2e4,step:1,precision:0,tooltip:"Mana regenerated per second"}]},{title:"Skill Settings",fields:[{key:"skill.baseCost",label:"Gem Base Cost",min:0,max:1e3,step:1,precision:0,tooltip:"Base mana cost of the skill gem"},{key:"skill.costMultiplier",label:"Cost Multiplier",min:.1,max:5,step:1e-4,precision:4,tooltip:"Cost multiplier from support gem"},{key:"skill.extraCostPercent",label:"Extra Cost %",min:0,max:1,step:.01,precision:3,tooltip:"Extra cost (% max mana), e.g. Archmage support"},{key:"skill.incCostPercent",label:"Increased Cost %",min:0,max:500,step:1,precision:0,tooltip:"Increased cost (%), e.g. Tree, gear, Indigon effects"},{key:"skill.moreLessCost",label:"More/Less Cost Multiplier",min:0,max:2,step:.01,precision:2,tooltip:"More/Less cost multiplier, e.g. Tree, Gear, gem supports"},{key:"skill.castPerSecond",label:"Casts per Second",min:.1,max:20,step:.1,precision:1,tooltip:"Casts per second"}]},{title:"Indigon Settings",fields:[{key:"indigon.dmgPer200",label:"Damage % per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Damage increase per 200 mana spent (35-50%)"},{key:"indigon.costIncPer200",label:"Cost % Increase per 200 Mana",min:27,max:61,step:1,precision:0,tooltip:"Cost increase per 200 mana spent (35-50%)"}]}];function $({form:s}){return e.jsx(T,{children:j.map(a=>{const o=a.title==="Indigon Settings",l=o?s.values.indigon.dmgPer200:void 0,t=o?s.values.indigon.costIncPer200:void 0,i=o&&(l!==void 0&&(l<35||l>50)||t!==void 0&&(t<35||t>50));return e.jsxs(h,{shadow:"xs",radius:"md",p:"md",style:{backgroundColor:i?"#fff3e0":void 0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:30,marginBottom:"0"},children:[e.jsx(f,{order:4,mb:"lg",children:a.title}),i&&e.jsx(c,{c:"orange",size:"xs",mb:"lg",children:"Such values require corrupted indigon."})]}),e.jsx(P,{cols:2,spacing:"md",children:a.fields.map(r=>e.jsx(u,{label:r.tooltip||"",disabled:!r.tooltip,children:e.jsx(A,{size:"sm",label:r.label,...s.getInputProps(r.key),min:r.min,max:r.max,step:r.step,decimalScale:r.precision,error:s.errors[r.key]})},r.key))})]},a.title)})})}const q=(s,a)=>a.some(o=>s>=o.x1&&s<=o.x2),J=s=>s.filter(a=>a.actual>a.ideal).map(a=>({x1:a.ideal,x2:a.actual}));function _({results:s}){const{ref:a,height:o}=z(),l=s.time.map((n,d)=>({time:n,mana:s.manaLeft[d],damage:s.spellDmg[d],missed:s.missedCast[d]})),t=J(s.castDelays),i=l.map(n=>({...n,delayArea:q(n.time,t)?n.damage:null})),r=s.castEvents.map(n=>n.actual);return e.jsxs(h,{shadow:"sm",radius:"md",p:"lg",style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(x,{ref:a,style:{flexGrow:1,minHeight:"330px"},children:o>0&&e.jsx(w,{width:"100%",height:o,children:e.jsxs(C,{data:i,children:[e.jsx(S,{dataKey:"time",type:"number",tick:{fontSize:12}}),e.jsx(k,{tick:{fontSize:12}}),e.jsx(v,{}),e.jsx(M,{}),e.jsx(y,{type:"monotone",dataKey:"mana",stroke:"#1E71A7",dot:!1,name:"Mana"}),e.jsx(y,{type:"monotone",dataKey:"damage",stroke:"#337128",dot:!1,name:"Damage"}),e.jsx(R,{type:"monotone",dataKey:"delayArea",name:"Delayed Cast",stroke:"red",fill:"red",fillOpacity:.1,dot:!1,activeDot:!1}),r.map((n,d)=>e.jsx(D,{x:n,stroke:"#000",strokeOpacity:.1,strokeDasharray:"3 3"},d))]})})})]})}function U({results:s}){const a=m.useMemo(()=>s.time.map((t,i)=>({time:t,spellDmg:s.spellDmg[i],manaLeft:s.manaLeft[i],manaCost:s.manaCost[i]})),[s]),o=m.useMemo(()=>[{accessorKey:"time",header:"Time (s)",Cell:({cell:t})=>t.getValue().toFixed(3)},{accessorKey:"spellDmg",header:"Spell Dmg %"},{accessorKey:"manaLeft",header:"Mana Left"},{accessorKey:"manaCost",header:"Mana Cost"}],[]),l=L({columns:o,data:a,enableColumnActions:!1,enableColumnFilters:!1,enableSorting:!1,enablePagination:!1,enableTopToolbar:!1,enableBottomToolbar:!1,enableFullScreenToggle:!1,enableHiding:!1,enableRowNumbers:!1,enableDensityToggle:!1,enableRowVirtualization:!0,layoutMode:"grid",mantineTableContainerProps:{style:{maxHeight:380}},mantineTableProps:{striped:"odd",withRowBorders:!0,withColumnBorders:!0,withTableBorder:!1}});return e.jsxs(h,{shadow:"sm",radius:"md",p:"lg",h:"100%",style:{display:"flex",flexDirection:"column"},children:[e.jsx(c,{size:"lg",fw:600,mb:"md",children:"Simulation Results"}),e.jsx(x,{style:{flexGrow:1},children:e.jsx(E,{table:l})})]})}function X(s){return new Worker("/indigon-poe2-calculator/assets/simulationWorker-DWBk_rnO.js",{name:s==null?void 0:s.name})}function Y(s){const a=s.timeToMaxDmg,o=s.maxSpellDmg,l=parseFloat(s.missRateAfterFirstMiss.toFixed(2)),t=parseFloat((100-l).toFixed(2)),i=Math.round(o*(t/100));let r="other",n="Check your stats.";return l<40?(r="perfect",n="Excellent - minimal misses (0-40% miss rate)."):l>=70?(r="red",n="Unstable - high miss rate (70%-100% miss rate)."):(r="warning",n="Moderate miss rate (40-70% miss rate)."),{status:r,message:n,details:{rampTime:a,maxSpellDmg:o,missRate:l,adjustedCastRate:t,estimatedSustainedDmg:i,additionalNote:"Sustaining Indigon without excessive misses is easier at slower cast speeds (which may lengthen ramp time)."}}}function Q({analysis:s}){const a={red:"red",warning:"yellow",perfect:"green",other:"blue"},{rampTime:o,maxSpellDmg:l,missRate:t,adjustedCastRate:i,estimatedSustainedDmg:r,additionalNote:n}=s.details;return e.jsxs(F,{color:a[s.status]||"blue",title:"Advices",children:[e.jsx(c,{size:"sm",children:s.message}),e.jsx(c,{size:"xs",mt:"xs",color:"dimmed",children:n}),e.jsx(B,{my:"sm"}),e.jsxs(p,{gap:"md",direction:"column",children:[e.jsxs(p,{justify:"space-between",wrap:"wrap",children:[e.jsx(u,{label:"Time needed to reach the maximum Indigon bonus",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Ramp Time:"})," ",o.toFixed(2),"s"]})}),e.jsx(u,{label:"The percentage of expected casts missed after reaching maximum ramp (lower is better)",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Miss Rate:"})," ",t.toFixed(2),"%"]})})]}),e.jsxs(p,{justify:"space-between",wrap:"wrap",children:[e.jsx(u,{label:"Highest bonus achieved during the simulation",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Max Indigon Bonus:"})," ",l,"%"]})}),e.jsx(u,{label:"Effective cast rate, calculated as 100 - Miss Rate",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Effective Cast Rate:"})," ",i.toFixed(2),"%"]})})]}),e.jsxs(p,{justify:"space-between",wrap:"wrap",children:[e.jsx(c,{size:"sm"}),e.jsx(u,{label:"Estimated sustained bonus computed as Max Bonus multiplied by Effective Cast Rate divided by 100",withArrow:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx("b",{children:"Estimated Sustained Bonus:"})," ",r,"%"]})})]})]})]})}function Z({config:s}){const[a,o]=m.useState("chart"),[l,t]=m.useState(null),[i,r]=m.useState(null);return m.useEffect(()=>{const n=new X;return n.postMessage(s),n.onmessage=d=>{const b=d.data;t(b),r(Y(b))},()=>n.terminate()},[s]),!l||!i?e.jsx(x,{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx("div",{children:"Waiting for data..."})}):e.jsxs(x,{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(G,{value:a,onChange:o,data:[{label:"Chart",value:"chart"},{label:"Table",value:"table"}],radius:"sm",size:"sm",fullWidth:!0,transitionDuration:150,styles:n=>({root:{backgroundColor:n.colors.gray[3],border:`1px solid ${n.colors.gray[3]}`,padding:0},label:{fontWeight:600},indicator:{boxShadow:n.shadows.sm}})}),e.jsx(x,{style:{flexGrow:1,overflow:"hidden"},children:a==="chart"?e.jsx(_,{results:l}):e.jsx(U,{results:l})}),e.jsx(Q,{analysis:i})]})}const ee=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,className:"icon icon-tabler icons-tabler-outline icon-tabler-brand-github",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z"}),e.jsx("path",{d:"M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"})]});function se(){return e.jsx(V,{gap:"xs",style:{position:"absolute",top:10,right:10},children:e.jsxs(K,{href:"https://github.com/tychota/indigon-calculator",target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:5},children:[e.jsx(ee,{}),e.jsx(c,{size:"xs",children:"by TychoTa"})]})})}function te(){const a=N({initialValues:{server:{tickInterval:.033,duration:40},player:{manaMax:6e3,manaRegen:3400},skill:{baseCost:72,costMultiplier:1.3799,extraCostPercent:0,incCostPercent:10,moreLessCost:.7,castPerSecond:5},indigon:{dmgPer200:33,costIncPer200:42}},validate:Object.fromEntries(j.flatMap(o=>o.fields.map(l=>[l.key,t=>{const{min:i,max:r,label:n}=l;return i!==void 0&&t<i?`${n} must be ≥ ${i}`:r!==void 0&&t>r?`${n} must be ≤ ${r}`:null}]))),onValuesChange:o=>{window.localStorage.setItem("form",JSON.stringify(o))}});return m.useEffect(()=>{if(window.localStorage.getItem("form"))try{a.setValues(JSON.parse(window.localStorage.getItem("form")))}catch{console.log("Failed to parse stored value")}},[]),e.jsxs(O,{fluid:!0,py:"md",children:[e.jsx(se,{}),e.jsx(f,{ta:"center",mb:"lg",children:"Indigon Spell Simulator"}),e.jsx(f,{order:3,ta:"center",mb:"xl",children:"Simulate your Indigon ramping in Poe2."}),e.jsxs(g,{gutter:"lg",align:"stretch",children:[e.jsx(g.Col,{span:{base:12,md:5},children:e.jsx(h,{shadow:"xs",radius:"md",p:"md",h:"100%",children:e.jsx($,{form:a})})}),e.jsx(g.Col,{span:{base:12,md:7},children:e.jsx(p,{direction:"column",gap:"md",h:"100%",children:e.jsx(h,{shadow:"xs",radius:"md",p:"md",style:{flexGrow:1,overflow:"hidden"},children:e.jsx(Z,{config:a.values})})})})]})]})}I.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(W,{theme:{...H},defaultColorScheme:"auto",children:e.jsx(te,{})})}));
